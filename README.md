# Multi-Review Skill

3-Way並列コードレビュースキル for Claude Code

複数のAIエージェント（OpenAI Codex CLI、Google Gemini CLI、Claude Code Task agent）を同時に実行し、多角的な視点からのコードレビューを提供します。

## 特徴

- **3並列実行**: 3つのAIエージェントが同時にレビューを実行
- **読み取り専用**: 全エージェントはサンドボックスモードで実行、ファイル変更なし
- **優先度付き統合**: 複数エージェントの指摘を優先度付けして統合
- **部分成功対応**: 一部エージェントが失敗しても他の結果で継続

## 前提条件

| 項目 | 必須/推奨 | 備考 |
|------|----------|------|
| Claude Code | 必須 | オーケストレーター |
| Codex CLI | 推奨 | `npm install -g @openai/codex` |
| Gemini CLI | 推奨 | `npm install -g @google/gemini-cli` |
| OPENAI_API_KEY | Codex使用時 | 環境変数に設定 |
| GOOGLE_API_KEY | Gemini使用時 | 環境変数に設定 |

**注意**: Codex CLI と Gemini CLI は両方とも推奨ですが、どちらか一方のみでも動作します（部分成功モード）。

## インストール

```bash
# リポジトリをクローン
git clone https://github.com/kdrd/skill-multi-review.git ~/skill-multi-review

# インストール実行
cd ~/skill-multi-review
./install.sh
```

インストールスクリプトは以下を行います:
1. 前提条件のチェック（Claude Code必須、Codex/Gemini推奨）
2. `~/.claude/skills/multi-review` へのシンボリックリンク作成

## 使用方法

```
/multi-review [対象] [レビュー依頼]
```

### パラメータ

| パラメータ | 必須 | 説明 |
|-----------|------|------|
| 対象ファイル/ディレクトリ | Yes | レビュー対象のパス |
| レビュー依頼内容 | Yes | レビューの観点・質問 |

### 使用例

```bash
# コード品質のレビュー
/multi-review src/ "コード品質をレビューして"

# セキュリティ観点でのチェック
/multi-review . "セキュリティ観点でチェック"

# 特定ファイルの認証ロジックをレビュー
/multi-review src/auth/login.ts "認証ロジックのセキュリティをレビューしてください"

# マイクロサービス間の依存関係をレビュー
/multi-review ./services/ "マイクロサービス間の依存関係をレビューしてください"
```

## Claude Code での使い方

### スキルの呼び出し

Claude Code のチャットウィンドウで以下のコマンドを入力:

```
/multi-review [対象ファイル/ディレクトリ] [レビュー依頼内容]
```

### 実行例

#### 1. プロジェクト全体のコード品質レビュー
```
/multi-review . "全体的なコード品質をレビューしてください"
```

#### 2. 特定ディレクトリのセキュリティ監査
```
/multi-review src/auth/ "セキュリティ脆弱性をチェックしてください"
```

#### 3. PRレビュー（変更ファイル指定）
```
/multi-review src/components/Login.tsx "この変更をレビューしてください"
```

### レビュー結果の読み方

レビュー結果は以下の優先度で表示されます:

| ラベル | 意味 | 対応 |
|--------|------|------|
| 🔴 CRITICAL | 全エージェントが指摘 | 即座に対応必須 |
| 🟠 HIGH | 2エージェントが指摘 | 強く推奨 |
| 🟡 MEDIUM | 1エージェントのみ | 検討推奨 |
| 🔵 DISCUSS | 意見が分かれた | ユーザー判断 |

## 出力形式

レビュー結果は優先度別に統合されて表示されます:

| 優先度 | 条件 | 意味 |
|--------|------|------|
| CRITICAL | 3エージェント全てが指摘 | 即座に対応が必要 |
| HIGH | 2エージェントが指摘 | 強く推奨される改善 |
| MEDIUM | 1エージェントのみ指摘 | 検討を推奨 |
| DISCUSS | エージェント間で相反 | 両論を提示、ユーザー判断 |

## アンインストール

```bash
cd ~/skill-multi-review
./uninstall.sh
```

シンボリックリンクのみを削除します。リポジトリ本体は残ります。

## トラブルシューティング

### CLI未インストール時の挙動

| 状況 | 挙動 |
|------|------|
| Codex CLI 未インストール | Gemini CLI + Claude Task のみで実行 |
| Gemini CLI 未インストール | Codex CLI + Claude Task のみで実行 |
| 両方未インストール | Claude Task Agent のみで実行 |

### よくある問題と対処

| 問題 | 原因 | 対処 |
|------|------|------|
| Codex CLI が起動しない | 未インストール | `npm install -g @openai/codex` |
| Gemini CLI がエラー | API キー未設定 | `gemini auth login` を実行 |
| Claude Task が遅い | 大量ファイル | 対象ディレクトリを絞る |
| 結果が少ない | プロンプト不足 | レビュー観点を具体化 |

### タイムアウト時の対処

- デフォルトタイムアウト: 300秒
- タイムアウト発生時は取得済みの部分結果で継続
- 未完了のエージェントは通知される

### エラーメッセージの意味

```
[WARNING] Codex CLI がタイムアウトしました。Gemini CLI と Claude Task Agent の結果を表示します。
```
→ Codex CLI が300秒以内に応答しませんでした。他のエージェントの結果は正常に取得されています。

```
[ERROR] 全エージェントが失敗しました。
```
→ 3つ全てのエージェントがエラーまたはタイムアウトしました。手動でのレビューを推奨します。

## 各エージェントの特性

| エージェント | 強み | 適したレビュー対象 |
|-------------|------|-------------------|
| Codex CLI | 行番号付き詳細指摘、依存関係分析 | 設定ファイル、エラー検出 |
| Gemini CLI | インストール問題検出、ベストプラクティス | パッケージ管理、構造評価 |
| Claude Code Task | 全体俯瞰、優先度付け、改善提案 | 結果統合、最終判断 |

## 安全性

- **読み取り専用の徹底**: 全エージェントは読み取り専用モードで実行
- **サンドボックス実行**: Codex (`--sandbox read-only`)、Gemini (`-s`)
- **ファイル変更禁止**: レビューコメントのみ提供、修正は一切行わない

## ライセンス

MIT License

---

*作成日: 2026-01-18*
